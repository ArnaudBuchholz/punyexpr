!function(e){"use strict";const u="literal",E="identifier",O="symbol",j="function";class q extends Error{constructor(e,t,r){super(t),this.name=e,this.offset=r}}q.throw=(e,t,r)=>{throw new q(e,t,r)};const n=(()=>{const r="abstract,arguments,await,boolean,break,byte,case,catch,char,class,const,continue,debugger,default,delete,do,double,else,enum,eval,export,extends,final,finally,float,for,function,goto,if,implements,import,in,instanceof,int,interface,let,long,native,new,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,try,var,void,volatile,while,with,yield".split(",");const t=new RegExp([/'((?:[^'\\]|\\.)*)'/,/"((?:[^"\\]|\\.)*)"/,/((?:\d+(?:\.\d*)?|\.\d+))/,/([a-zA-Z_][a-zA-Z_0-9]*)/,/(\+|-|\*|\/|\[|\]|\.|\?|:|%|<|=|>|!|&|\||\(|\)|,)/,/(\s)/,/(.)/].map(e=>{e=e.toString();return e.substring(1,e.length-1)}).join("|"),"g"),l=e=>q.throw("InvalidTokenError","Invalid token @"+e,e),n={true:!0,false:!1,undefined:void 0,null:null},c=[e=>[u,e.replace(/\\'/g,"'")],e=>[u,e.replace(/\\"/g,'"')],e=>[u,parseFloat(e)],(e,t)=>Object.prototype.hasOwnProperty.call(n,e)?[u,n[e]]:(r.includes(e)&&l(t),[E,e]),e=>[O,e],e=>[],(e,t)=>l(t)];return e=>{const o=[];let a=0,s;const i=[u,E];return e.replace(t,(e,...t)=>{var r=t.findIndex(e=>void 0!==e),t=t[r],[r,n]=(0,c[r])(t,a);i.includes(r)&&i.includes(s)&&l(a),void 0!==(s=r)&&o.push([r,n,a]),a+=t.length}),o}})(),o=(()=>{const i=(e,...t)=>Object.assign(e[1].bind(null,...t),{op:e[0],args:t}),s=["constant",e=>e],r=["rootGet",(e,t)=>t[e(t)]],l=["get",(e,t,r)=>{e=e(r),t=e[t(r)];return typeof t===j?t.bind(e):t}],c=["not",(e,t)=>!e(t)];const u=["add",(e,t,r)=>e(r)+t(r)],d=["sub",(e,t,r)=>e(r)-t(r)];const n=["ternary",(e,t,r,n)=>(e(n)?t:r)(n)],p=["getTypeof",(e,t)=>typeof e(t)],f=["call",(e,t,r)=>e(r).apply(null,t.map(e=>e(r)))],o=e=>{0===e.length&&q.throw("EndOfExpressionError","Unexpected end of expression")},v=e=>(o(e),e[0]),a=e=>v(e)[2],h=(e,t=1)=>e.splice(0,t),g=(e,t=void 0)=>{var r;return 0!==e.length&&([e,r]=e[0],e===O)&&(!t||t.includes(r))},b=(e,t)=>{var r=[];for(const s of e){var[n,o]=s;if(n!==O)break;r.push(o)}const a=r.join("");t=t.filter(e=>a.startsWith(e)).sort((e,t)=>t.length-e.length)[0];return!!t&&(h(e,t.length),t)},y=e=>q.throw("UnexpectedTokenError","Unexpected token @"+a(e),a(e));var e=(o,a)=>{const s=Object.keys(a);return e=>{let t=o(e),r=b(e,s);for(;r;){var n=o(e);t=i(a[r],t,n),r=b(e,s)}return t}};const w=e=>{if(o(e),g(e,"("))return h(e),t=k(e),g(e,")")||y(e),h(e),t;g(e)&&y(e);var[[t,e]]=h(e);return t===E?i(r,i(s,e)):i(s,e)};const m=e(e(e(e(e(e(e(t=>{var[e,r]=v(t);if(g(t,"+-!")||e===E&&"typeof"===r){h(t);let e=k(t);return e="+"===r?i(u,i(s,0),e):"-"===r?i(d,i(s,0),e):"!"===r?i(c,e):i(p,e)}{var n=t;let r=w(n);for(var o={"(":()=>{for(var e=[];!g(n,")");)0<e.length&&(g(n,",")||y(n),h(n)),e.push(k(n));h(n),r=i(f,r,e)},"[":()=>{var e=k(n);g(n,"]")||y(n),h(n),r=i(l,r,e)},".":()=>{var[e,t]=v(n);e!==E&&y(n),h(n),r=i(l,r,i(s,t))}};g(n,"([.");){var[[,a]]=h(n);o[a](r)}return r}},{"**":["exp",(e,t,r)=>e(r)**t(r)]}),{"*":["mul",(e,t,r)=>e(r)*t(r)],"/":["div",(e,t,r)=>e(r)/t(r)],"%":["remainder",(e,t,r)=>e(r)%t(r)]}),{"+":u,"-":d}),{"<":["lt",(e,t,r)=>e(r)<t(r)],">":["gt",(e,t,r)=>e(r)>t(r)],"<=":["lte",(e,t,r)=>e(r)<=t(r)],">=":["gte",(e,t,r)=>e(r)>=t(r)]}),{"==":["eq",(e,t,r)=>e(r)==t(r)],"!=":["neq",(e,t,r)=>e(r)!=t(r)],"===":["eqq",(e,t,r)=>e(r)===t(r)],"!==":["neqq",(e,t,r)=>e(r)!==t(r)]}),{"&&":["and",(e,t,r)=>e(r)&&t(r)]}),{"||":["or",(e,t,r)=>e(r)||t(r)]}),x=e=>{var t,r=m(e);return b(e,["?"])?(t=x(e),o(e),g(e,":")||y(e),h(e),e=x(e),i(n,r,t,e)):r},k=x;return e=>{var t=k(e);return 0!==e.length&&q.throw("UnexpectedRemainderError","Unexpected left over tokens @"+a(e),a(e)),t}})(),a=e=>({value:e,writable:!1}),s=(e,r)=>{Object.defineProperties(e,Object.keys(r).reduce((e,t)=>(e[t]=a(r[t]),e),{}))},i=e=>({[e.op]:e.args.map(e=>typeof e===j?i(e):Array.isArray(e)?e.map(i):e)});var t=e=>{const t=o(n(e));var r=(e={})=>t(e);return s(r,{toJSON:i.bind(null,t),toString:()=>e}),r};s(t,{tokenize:n,Error:q,version:"1.0.2"}),e.punyexpr=t}(this);
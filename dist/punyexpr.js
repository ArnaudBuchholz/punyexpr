!function(e){"use strict";const c="literal",F="identifier",J="symbol",N="function";class W extends Error{constructor(e,r,t){super(r),this.name=e,this.offset=t}}W.throw=(e,r,t)=>{throw new W(e,r,t)};const n=(()=>{const t="abstract,arguments,await,boolean,break,byte,case,catch,char,class,const,continue,debugger,default,delete,do,double,else,enum,eval,export,extends,final,finally,float,for,function,goto,if,implements,import,in,instanceof,int,interface,let,long,native,new,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,try,var,void,volatile,while,with,yield".split(",");const r=new RegExp([/'((?:[^'\\]|\\.)*)'/,/"((?:[^"\\]|\\.)*)"/,/((?:\d+(?:\.\d*)?|\.\d+))/,/([a-zA-Z_][a-zA-Z_0-9]*)/,/(\+|-|\*|\/|\[|\]|\.|\?|:|%|<|=|>|!|&|\||\(|\)|,)/,/(\s)/,/(.)/].map(e=>{e=e.toString();return e.substring(1,e.length-1)}).join("|"),"g"),i=e=>W.throw("InvalidTokenError","Invalid token @"+e,e),n={true:!0,false:!1,undefined:void 0,null:null},l=[e=>[c,e.replace(/\\'/g,"'")],e=>[c,e.replace(/\\"/g,'"')],e=>[c,parseFloat(e)],(e,r)=>Object.prototype.hasOwnProperty.call(n,e)?[c,n[e]]:(t.includes(e)&&i(r),[F,e]),e=>[J,e],e=>[],(e,r)=>i(r)];return e=>{const n=[];let o=0,a;const s=[c,F];return e.replace(r,({length:e},...r)=>{var t=r.findIndex(e=>void 0!==e),r=r[t],[t,r]=(0,l[t])(r,o);s.includes(t)&&s.includes(a)&&i(o),void 0!==(a=t)&&n.push([t,r,o,e]),o+=e}),n}})(),o=(()=>{var e=(t,n)=>(e,...r)=>Object.assign(n.bind(null,...r),{$:[t,r,e]});const l=e("constant",e=>e),i=e("array",(...e)=>{const r=e.at(-1);return e.slice(0,-1).map(e=>e(r))}),c=e("context",(e,r)=>r[e(r)]),u=e("property",(e,r,t)=>{e=e(t),r=e[r(t)];return typeof r===N?r.bind(e):r}),p=e("call",(e,r,t)=>e(t).apply(null,r.map(e=>e(t)))),d=e("neg",(e,r)=>-e(r)),v=e("not",(e,r)=>!e(r)),f=e("getTypeof",(e,r)=>typeof e(r));var r=e("exp",(e,r,t)=>e(t)**r(t)),t=e("mul",(e,r,t)=>e(t)*r(t)),n=e("div",(e,r,t)=>e(t)/r(t)),o=e("remainder",(e,r,t)=>e(t)%r(t)),a=e("add",(e,r,t)=>e(t)+r(t)),s=e("sub",(e,r,t)=>e(t)-r(t)),h=e("lt",(e,r,t)=>e(t)<r(t)),g=e("gt",(e,r,t)=>e(t)>r(t)),y=e("lte",(e,r,t)=>e(t)<=r(t)),b=e("gte",(e,r,t)=>e(t)>=r(t)),w=e("eq",(e,r,t)=>e(t)==r(t)),m=e("neq",(e,r,t)=>e(t)!=r(t)),x=e("eqq",(e,r,t)=>e(t)===r(t)),k=e("neqq",(e,r,t)=>e(t)!==r(t)),E=e("and",(e,r,t)=>e(t)&&r(t)),O=e("or",(e,r,t)=>e(t)||r(t));const j=e("ternary",(e,r,t,n)=>(e(n)?r:t)(n)),q=e=>{0===e.length&&W.throw("EndOfExpressionError","Unexpected end of expression")},A=e=>(q(e),e[0]),U=e=>A(e)[2],z=(e,r)=>{let t;var[e,n]=t=Array.isArray(e)?A(e).splice(2):e.$[2];return[r,e+n-r]},I=(e,r=1)=>e.splice(0,r),S=(e,r=void 0)=>{var t;return 0!==e.length&&([e,t]=e[0],e===J)&&(!r||r.includes(t))},T=(e,r)=>{var t=[];for(const s of e){var[n,o]=s;if(n!==J)break;t.push(o)}const a=t.join("");r=r.filter(e=>a.startsWith(e)).sort((e,r)=>r.length-e.length)[0];return!!r&&(I(e,r.length),r)},$=e=>W.throw("UnexpectedTokenError","Unexpected token @"+U(e),U(e)),Z=e=>{if(q(e),S(e,"("))return I(e),t=R(e),S(e,")")||$(e),I(e),t;if(S(e,"[")){for(var r=e,t=U(r),n=(I(r),[]);!S(r,"]");){var o=R(r);n.push(o),S(r,",")&&I(r)}return t=z(r,t),I(r),i(t,...n)}S(e)&&$(e);var[[e,a,...s]]=I(e);return e===F?c(s,l(s,a)):l(s,a)};e=(s,i)=>{const l=Object.keys(i);return e=>{var r=U(e);let t=s(e),n=T(e,l);for(;n;){var o=s(e),a=z(o,r);t=i[n](a,t,o),n=T(e,l)}return t}};const _=e(e(e(e(e(e(e(r=>{var[t,n,o]=A(r);if(S(r,"+-!")||t===F&&"typeof"===n){t=z(r,o);I(r);let e=R(r);return"-"===n?e=d(t,e):"!"===n?e=v(t,e):"typeof"===n&&(e=f(t,e)),e}{var a=r;const i=U(a);let n=Z(a);for(var e={"(":()=>{for(var e=[];!S(a,")");)0<e.length&&(S(a,",")||$(a),I(a)),e.push(R(a));var r=z(a,i);I(a),n=p(r,n,e)},"[":()=>{var e=R(a),r=(S(a,"]")||$(a),z(a,i));I(a),n=u(r,n,e)},".":()=>{var[e,r,...t]=A(a),e=(e!==F&&$(a),z(a,i));I(a),n=u(e,n,l(t,r))}};S(a,"([.");){var[[,s]]=I(a);e[s](n)}return n}},{"**":r}),{"*":t,"/":n,"%":o}),{"+":a,"-":s}),{"<":h,">":g,"<=":y,">=":b}),{"==":w,"!=":m,"===":x,"!==":k}),{"&&":E}),{"||":O}),P=e=>{var r,t=U(e),n=_(e);return T(e,["?"])?(r=P(e),q(e),S(e,":")||$(e),I(e),e=P(e),t=z(e,t),j(t,n,r,e)):n},R=P;return e=>{var r=R(e);return 0!==e.length&&W.throw("UnexpectedRemainderError","Unexpected left over tokens @"+U(e),U(e)),r}})(),a=e=>({value:e,writable:!1}),s=(e,t)=>{Object.defineProperties(e,Object.keys(t).reduce((e,r)=>(e[r]=a(t[r]),e),{}))},i=e=>{var[e,r,[t,n]]=e.$;return{op:e,at:t,length:n,args:r.map(e=>typeof e===N?i(e):Array.isArray(e)?e.map(i):e)}};var r=e=>{const r=o(n(e));var t=(e={})=>r(e);return s(t,{toJSON:i.bind(null,r),toString:()=>e}),t};s(r,{tokenize:n,Error:W,version:"1.0.3"}),e.punyexpr=r}(this);
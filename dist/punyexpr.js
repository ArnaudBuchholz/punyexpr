!function(e){"use strict";const c="literal",_="identifier",F="symbol",J="function";class N extends Error{constructor(e,t,r){super(t),this.name=e,this.offset=r}}N.throw=(e,t,r)=>{throw new N(e,t,r)};const n=(()=>{const r="abstract,arguments,await,boolean,break,byte,case,catch,char,class,const,continue,debugger,default,delete,do,double,else,enum,eval,export,extends,final,finally,float,for,function,goto,if,implements,import,in,instanceof,int,interface,let,long,native,new,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,try,var,void,volatile,while,with,yield".split(",");const t=new RegExp([/'((?:[^'\\]|\\.)*)'/,/"((?:[^"\\]|\\.)*)"/,/((?:\d+(?:\.\d*)?|\.\d+))/,/([a-zA-Z_][a-zA-Z_0-9]*)/,/(\+|-|\*|\/|\[|\]|\.|\?|:|%|<|=|>|!|&|\||\(|\)|,)/,/(\s)/,/(.)/].map(e=>{e=e.toString();return e.substring(1,e.length-1)}).join("|"),"g"),i=e=>N.throw("InvalidTokenError","Invalid token @"+e,e),n={true:!0,false:!1,undefined:void 0,null:null},l=[e=>[c,e.replace(/\\'/g,"'")],e=>[c,e.replace(/\\"/g,'"')],e=>[c,parseFloat(e)],(e,t)=>Object.prototype.hasOwnProperty.call(n,e)?[c,n[e]]:(r.includes(e)&&i(t),[_,e]),e=>[F,e],e=>[],(e,t)=>i(t)];return e=>{const n=[];let o=0,a;const s=[c,_];return e.replace(t,({length:e},...t)=>{var r=t.findIndex(e=>void 0!==e),t=t[r],[r,t]=(0,l[r])(t,o);s.includes(r)&&s.includes(a)&&i(o),void 0!==(a=r)&&n.push([r,t,o,e]),o+=e}),n}})(),o=(()=>{var e=(r,n)=>(e,...t)=>Object.assign(n.bind(null,...t),{$:[r,t,e]});const l=e("constant",e=>e),n=e("context",(e,t)=>t[e(t)]),c=e("property",(e,t,r)=>{e=e(r),t=e[t(r)];return typeof t===J?t.bind(e):t}),u=e("call",(e,t,r)=>e(r).apply(null,t.map(e=>e(r)))),p=e("neg",(e,t)=>-e(t)),d=e("not",(e,t)=>!e(t)),v=e("getTypeof",(e,t)=>typeof e(t));var t=e("exp",(e,t,r)=>e(r)**t(r)),r=e("mul",(e,t,r)=>e(r)*t(r)),o=e("div",(e,t,r)=>e(r)/t(r)),a=e("remainder",(e,t,r)=>e(r)%t(r)),s=e("add",(e,t,r)=>e(r)+t(r)),i=e("sub",(e,t,r)=>e(r)-t(r)),f=e("lt",(e,t,r)=>e(r)<t(r)),h=e("gt",(e,t,r)=>e(r)>t(r)),g=e("lte",(e,t,r)=>e(r)<=t(r)),y=e("gte",(e,t,r)=>e(r)>=t(r)),b=e("eq",(e,t,r)=>e(r)==t(r)),w=e("neq",(e,t,r)=>e(r)!=t(r)),x=e("eqq",(e,t,r)=>e(r)===t(r)),m=e("neqq",(e,t,r)=>e(r)!==t(r)),k=e("and",(e,t,r)=>e(r)&&t(r)),E=e("or",(e,t,r)=>e(r)||t(r));const O=e("ternary",(e,t,r,n)=>(e(n)?t:r)(n)),j=e=>{0===e.length&&N.throw("EndOfExpressionError","Unexpected end of expression")},q=e=>(j(e),e[0]),A=e=>q(e)[2],U=(e,t)=>{let r;var[e,n]=r=Array.isArray(e)?q(e).splice(2):e.$[2];return[t,e+n-t]},z=(e,t=1)=>e.splice(0,t),I=(e,t=void 0)=>{var r;return 0!==e.length&&([e,r]=e[0],e===F)&&(!t||t.includes(r))},S=(e,t)=>{var r=[];for(const s of e){var[n,o]=s;if(n!==F)break;r.push(o)}const a=r.join("");t=t.filter(e=>a.startsWith(e)).sort((e,t)=>t.length-e.length)[0];return!!t&&(z(e,t.length),t)},T=e=>N.throw("UnexpectedTokenError","Unexpected token @"+A(e),A(e)),$=e=>{if(j(e),I(e,"("))return z(e),t=R(e),I(e,")")||T(e),z(e),t;I(e)&&T(e);var[[t,e,...r]]=z(e);return t===_?n(r,l(r,e)):l(r,e)};e=(s,i)=>{const l=Object.keys(i);return e=>{var t=A(e);let r=s(e),n=S(e,l);for(;n;){var o=s(e),a=U(o,t);r=i[n](a,r,o),n=S(e,l)}return r}};const Z=e(e(e(e(e(e(e(t=>{var[r,n,o]=q(t);if(I(t,"+-!")||r===_&&"typeof"===n){r=U(t,o);z(t);let e=R(t);return"-"===n?e=p(r,e):"!"===n?e=d(r,e):"typeof"===n&&(e=v(r,e)),e}{var a=t;const i=A(a);let n=$(a);for(var e={"(":()=>{for(var e=[];!I(a,")");)0<e.length&&(I(a,",")||T(a),z(a)),e.push(R(a));var t=U(a,i);z(a),n=u(t,n,e)},"[":()=>{var e=R(a),t=(I(a,"]")||T(a),U(a,i));z(a),n=c(t,n,e)},".":()=>{var[e,t,...r]=q(a),e=(e!==_&&T(a),U(a,i));z(a),n=c(e,n,l(r,t))}};I(a,"([.");){var[[,s]]=z(a);e[s](n)}return n}},{"**":t}),{"*":r,"/":o,"%":a}),{"+":s,"-":i}),{"<":f,">":h,"<=":g,">=":y}),{"==":b,"!=":w,"===":x,"!==":m}),{"&&":k}),{"||":E}),P=e=>{var t,r=A(e),n=Z(e);return S(e,["?"])?(t=P(e),j(e),I(e,":")||T(e),r=U(e,r),z(e),e=P(e),O(r,n,t,e)):n},R=P;return e=>{var t=R(e);return 0!==e.length&&N.throw("UnexpectedRemainderError","Unexpected left over tokens @"+A(e),A(e)),t}})(),a=e=>({value:e,writable:!1}),s=(e,r)=>{Object.defineProperties(e,Object.keys(r).reduce((e,t)=>(e[t]=a(r[t]),e),{}))},i=e=>{var[e,t,[r,n]]=e.$;return{op:e,at:r,length:n,args:t.map(e=>typeof e===J?i(e):Array.isArray(e)?e.map(i):e)}};var t=e=>{const t=o(n(e));var r=(e={})=>t(e);return s(r,{toJSON:i.bind(null,t),toString:()=>e}),r};s(t,{tokenize:n,Error:N,version:"1.0.3"}),e.punyexpr=t}(this);